<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0f3b2e" />
  <title>Angel｜課程設計工作台</title>
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./assets/icons/icon-192.png" />
  <link rel="apple-touch-icon" href="./assets/icons/icon-192.png" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">A</div>
      <div class="brand-text">
        <div class="brand-title">Angel｜課程設計工作台</div>
        <div class="brand-sub">Step 2-3｜AI 指令完整＋接通課程管理 API（不遮罩）</div>
      </div>
    </div>
    <div class="top-actions">
      <button id="btnReloadTools" class="btn ghost">同步工具庫</button>
      <button id="btnShowToolsDebug" class="btn ghost">工具回傳</button>
      <button id="btnToggleSettings" class="btn ghost">設定</button>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="card-hd">
        <div class="hd-title">狀態進度</div>
        <div class="hd-note">發想 → 草稿 → 完稿｜按狀態輸出 AI 指令與 TSV，並可送進試算表</div>
      </div>
      <div class="progress">
        <button class="pill" data-state="idea"><span class="dot" id="dotIdea"></span>發想</button>
        <button class="pill" data-state="draft"><span class="dot" id="dotDraft"></span>草稿</button>
        <button class="pill" data-state="final"><span class="dot" id="dotFinal"></span>完稿</button>
      </div>
      <div class="statusline">
        <div>目前狀態：<span id="stateLabel" class="badge">發想</span></div>
        <div class="mini" id="apiHint"></div>
      </div>
    </section>

    <section id="settingsCard" class="card" style="display:none">
      <div class="card-hd">
        <div class="hd-title">設定</div>
        <div class="hd-note">這裡只放「會用到」的最少設定，避免複雜</div>
      </div>
      <div class="card-bd">
        <div class="grid two">
          <div class="field">
            <label>owner（可先空白）</label>
            <input id="f_owner" placeholder="例如：天使笑長 / 你自己的名字" />
          </div>
          <div class="field">
            <label>version</label>
            <input id="f_version" placeholder="例如 v1 / v1.1" />
          </div>
        </div>
        <div class="grid two">
          <div class="field">
            <label>course_kind（形式）</label>
            <select id="f_kind">
              <option value="module">模組課程</option>
              <option value="lecture">演講</option>
              <option value="class">單場課程</option>
              <option value="activity">單場活動</option>
            </select>
          </div>
          <div class="field">
            <label>type（類型/平台）</label>
            <input id="f_type" placeholder="現場 / 線上 / 校園 / 親子活動…" />
          </div>
        </div>
        <div class="grid two">
          <div class="field">
            <label>sessions_count（場次/單元）</label>
            <input id="f_sessions" placeholder="8（單場填 1）" />
          </div>
          <div class="field">
            <label>duration_min（單場分鐘）</label>
            <input id="f_duration" placeholder="120" />
          </div>
        </div>
        <div class="grid two">
          <div class="field">
            <label>days（天數）</label>
            <input id="f_days" placeholder="1" />
          </div>
          <div class="field">
            <label>hours_total（總時數）</label>
            <input id="f_hours" placeholder="2" />
          </div>
        </div>
        <div class="grid two">
          <div class="field">
            <label>capacity（人數）</label>
            <input id="f_capacity" placeholder="20" />
          </div>
          <div class="field">
            <label>從後臺載入（本狀態清單）</label>
            <button id="btnLoadFromApi" class="btn">載入清單</button>
          </div>
        </div>
        <div id="apiListArea" class="api-list" style="margin-top:10px;"></div>

        <div class="hint">
          <div><b>工具庫 API</b>（讀）：<span class="mono" id="toolApiLabel"></span></div>
          <div><b>課程管理 API</b>（寫）：<span class="mono" id="courseApiLabel"></span></div>
          <div class="mini">送出若失敗：仍可用「TSV 一列」貼回試算表（最保守備援）。</div>
        </div>
      </div>
    </section>

    <section class="wizard">
      <div class="wizard-hd">
        <h2>四步驟 Wizard</h2>
        <div class="mini">I-3：工具庫勾選（主工具單選 / 副工具多選）＋自動整理 links</div>
      </div>
      <div id="stepsArea" class="steps"></div>
    </section>

    <div class="bottom-safe"></div>
  </main>

  <footer class="sticky">
    <div class="sticky-inner">
      <button id="btnCopyAI" class="btn primary">一鍵複製｜AI 指令（完整）</button>
      <button id="btnCopyTSV" class="btn">一鍵複製｜TSV 一列</button>
      <button id="btnSendApi" class="btn">送出｜寫入試算表（本狀態）</button>
      <button id="btnSaveLocal" class="btn">存本機草稿</button>
      <button id="btnExportJson" class="btn">匯出 JSON</button>
    </div>
    <div class="sticky-meta">
      <span>狀態：<b id="stateLabelBottom">發想</b></span>
      <span class="mini" id="toast"></span>
    </div>
  </footer>

  <script src="./app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
  </script>
</body>
</html>
