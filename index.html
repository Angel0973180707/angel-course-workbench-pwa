<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Angel｜課程管理工房</title>
  <meta name="theme-color" content="#133a2a" />
  <meta name="description" content="Angel Course Manager Workbench｜發想/草稿/完稿課程管理＋工具庫存勾選＋單場完稿組模組" />

  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icons/icon-192.png" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />

  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">ANGEL</div>
      <div class="meta">
        <div class="title">課程管理工房</div>
        <div class="subtitle">發想 / 草稿 / 完稿｜工具勾選｜單場完稿 → 模組課程</div>
      </div>
    </div>
    <div class="topbar-actions">
      <button class="btn btn-ghost" id="btn-install" hidden>安裝</button>
      <button class="btn" id="btn-refresh">刷新</button>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="card-hd">
        <div>
          <h2>快速操作</h2>
          <p class="muted">先把需要的按鈕放在手邊：同步、備份、文稿、組模組。</p>
        </div>
        <div class="pill">Wizard</div>
      </div>

      <div class="grid-2">
        <div class="panel">
          <h3>後臺同步</h3>
          <div class="row">
            <button class="btn" id="btn-sync-push">同步到後臺（本狀態）</button>
            <button class="btn btn-ghost" id="btn-sync-pull">從後臺抓（本狀態清單）</button>
          </div>
          <div class="row">
            <div class="muted small">API 連線狀態：<span id="api-status">—</span></div>
          </div>
          <pre class="code" id="api-last">（尚無）</pre>
        </div>

        <div class="panel">
          <h3>本機草稿（localStorage）</h3>
          <div class="row">
            <button class="btn" id="btn-local-save">存本機草稿</button>
            <button class="btn btn-ghost" id="btn-local-load">叫出本機草稿</button>
            <button class="btn btn-ghost" id="btn-local-clear">清空本機草稿</button>
          </div>
          <div class="row">
            <button class="btn btn-ghost" id="btn-export-json">匯出 JSON</button>
            <button class="btn btn-ghost" id="btn-copy-tsv">一鍵複製｜TSV 一列</button>
          </div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="tabs" role="tablist">
        <button class="tab active" data-tab="idea" role="tab">發想</button>
        <button class="tab" data-tab="draft" role="tab">草稿</button>
        <button class="tab" data-tab="final" role="tab">完稿</button>
        <button class="tab" data-tab="tools" role="tab">工具庫存</button>
      </div>

      <!-- IDEA -->
      <section class="tabpage active" id="tab-idea">
        <div class="workspace">
          <aside class="sidebar">
            <div class="side-hd">
              <div class="state-title">發想清單</div>
              <div class="side-actions">
                <input class="input" id="q-idea" placeholder="搜尋（標題/標籤/摘要）" />
                <button class="btn btn-ghost" data-action="reload" data-state="idea">更新</button>
              </div>
            </div>
            <div class="list" id="list-idea"></div>
          </aside>

          <section class="editor">
            <div class="editor-hd">
              <div>
                <h3>編輯｜發想</h3>
                <p class="muted small">沒填 id 也可以，系統會自動生一個。</p>
              </div>
              <div class="editor-actions">
                <button class="btn btn-ghost" data-action="new" data-state="idea">新增</button>
                <button class="btn" data-action="save" data-state="idea">存到後臺</button>
              </div>
            </div>
            <div class="form" data-form="idea"></div>
          </section>
        </div>
      </section>

      <!-- DRAFT -->
      <section class="tabpage" id="tab-draft">
        <div class="workspace">
          <aside class="sidebar">
            <div class="side-hd">
              <div class="state-title">草稿清單</div>
              <div class="side-actions">
                <input class="input" id="q-draft" placeholder="搜尋（標題/標籤/摘要）" />
                <button class="btn btn-ghost" data-action="reload" data-state="draft">更新</button>
              </div>
            </div>
            <div class="list" id="list-draft"></div>
          </aside>

          <section class="editor">
            <div class="editor-hd">
              <div>
                <h3>編輯｜草稿</h3>
                <p class="muted small">建議：草稿 id 仍可沿用發想 id（方便追蹤）。</p>
              </div>
              <div class="editor-actions">
                <button class="btn btn-ghost" data-action="new" data-state="draft">新增</button>
                <button class="btn" data-action="save" data-state="draft">存到後臺</button>
              </div>
            </div>
            <div class="form" data-form="draft"></div>
          </section>
        </div>
      </section>

      <!-- FINAL -->
      <section class="tabpage" id="tab-final">
        <div class="workspace">
          <aside class="sidebar">
            <div class="side-hd">
              <div class="state-title">完稿清單</div>
              <div class="side-actions">
                <input class="input" id="q-final" placeholder="搜尋（標題/標籤/摘要）" />
                <button class="btn btn-ghost" data-action="reload" data-state="final">更新</button>
              </div>
            </div>
            <div class="hint small muted">✅ 你可以勾選多個「單場完稿」，一鍵組成「模組課程」並存入完稿。</div>
            <div class="list" id="list-final"></div>
            <div class="sticky-bar">
              <button class="btn" id="btn-make-module" disabled>組合成模組課程（存入完稿）</button>
              <div class="small muted" id="module-selected">已選 0</div>
            </div>
          </aside>

          <section class="editor">
            <div class="editor-hd">
              <div>
                <h3>編輯｜完稿</h3>
                <p class="muted small">完稿會存到「幸福教養課程管理」分頁。</p>
              </div>
              <div class="editor-actions">
                <button class="btn btn-ghost" data-action="new" data-state="final">新增</button>
                <button class="btn" data-action="save" data-state="final">存到後臺</button>
              </div>
            </div>
            <div class="form" data-form="final"></div>
          </section>
        </div>
      </section>

      <!-- TOOLS -->
      <section class="tabpage" id="tab-tools">
        <div class="workspace">
          <aside class="sidebar">
            <div class="side-hd">
              <div class="state-title">工具庫存（後臺）</div>
              <div class="side-actions">
                <input class="input" id="q-tools" placeholder="搜尋（工具名稱/標籤）" />
                <button class="btn btn-ghost" id="btn-tools-reload">更新</button>
              </div>
            </div>
            <div class="hint small muted">工具庫存你手動維護在「工具庫存管理」分頁。這裡只負責列出並供你勾選。</div>
            <div class="list" id="list-tools"></div>
          </aside>

          <section class="editor">
            <div class="editor-hd">
              <div>
                <h3>已選工具</h3>
                <p class="muted small">你在任一狀態的課程編輯器，都能一鍵帶入「tools_used」。</p>
              </div>
              <div class="editor-actions">
                <button class="btn" id="btn-apply-tools">套用到目前課程（tools_used）</button>
                <button class="btn btn-ghost" id="btn-clear-tools">清空選取</button>
              </div>
            </div>
            <div class="panel">
              <div class="chips" id="tools-chips"></div>
              <div class="muted small" style="margin-top:10px;">提示：工具清單只是「勾選器」，資料仍以試算表為主。</div>
            </div>
          </section>
        </div>
      </section>
    </section>
  </main>

  <!-- Module Modal -->
  <dialog class="modal" id="dlg-module">
    <form method="dialog" class="modal-card">
      <div class="modal-hd">
        <h3>組合成模組課程</h3>
        <button class="icon-btn" value="cancel" aria-label="close">✕</button>
      </div>
      <div class="modal-bd">
        <label class="field">
          <div class="label">模組名稱（title）</div>
          <input class="input" id="module-title" placeholder="例如：情緒急救 × 120 分鐘親子體驗" required />
        </label>
        <div class="grid-2">
          <label class="field">
            <div class="label">kind</div>
            <select class="input" id="module-kind">
              <option value="模組課程">模組課程</option>
              <option value="活動">活動</option>
              <option value="演講">演講</option>
              <option value="其他">其他</option>
            </select>
          </label>
          <label class="field">
            <div class="label">每堂時間（session_minutes）</div>
            <input class="input" id="module-session-min" placeholder="例如：40 或 40-50" />
          </label>
        </div>
        <label class="field">
          <div class="label">備註</div>
          <textarea class="input" id="module-notes" rows="3" placeholder="想提醒自己或助教的重點"></textarea>
        </label>
        <div class="panel" id="module-preview"></div>
      </div>
      <div class="modal-ft">
        <button class="btn btn-ghost" value="cancel">取消</button>
        <button class="btn" id="btn-module-confirm" value="ok">建立並存入完稿</button>
      </div>
    </form>
  </dialog>

  <div class="toast" id="toast" aria-live="polite"></div>

  <script src="./app.js"></script>
</body>
</html>
